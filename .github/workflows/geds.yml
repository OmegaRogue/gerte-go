name: GEDS

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:

  geds-test:
    name: Build
    runs-on: ubuntu-latest
    steps:

    - name: Set up Go 1.x
      uses: actions/setup-go@v2
      with:
        go-version: ^1.14.2
      id: go

    - name: Check out code into the Go module directory
      uses: actions/checkout@v2

    - name: Get dependencies
      run: |
        go get -v -t -d ./...
        if [ -f Gopkg.toml ]; then
            curl https://raw.githubusercontent.com/golang/dep/master/install.sh | sh
            dep ensure
        fi
    - name: clone geds
      run: git clone https://github.com/GlobalEmpire/GERT test/GERT
      
    
    - name: Run Makefile
      run: make debug
      working-directory: test/GERT/GERTe
      
    - name: Copy resolutions into GEDS directory
      run: mv test/resolutions.geds test/GERT/GERTe
      
    - name: Start GEDS
      id: start-geds
      run: ls -a test/GERT/GERTe
      #run: ./GEDSv1.1 -a 0.0.0.0 -d &
      
    - name: Run example
      run: go run examples/basic/main.go
      if: steps.start-geds.outputs.conclusion == 'success'
